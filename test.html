<script src="build/subsonic-api.min.js"></script>
<script>
  (() => {

    var subsonic = new SubsonicAPI({
      https: false,
      ip: 'dough10.me',
      port: 4040,
      user: 'admin',
      password: 'oicu812bitch',
      appName: 'SubsonicAPI Test'
    });

    document.addEventListener('subsonicApi-ready', (event) => {
      // check event.detail.status for 'ok'
      if (event.detail.status === 'ok') {
        // can now make api calls
        // event.detail.user contains user permissions from subsonic
        console.log('Welcome ' + event.detail.user.username);
        subsonic.getMusicFolders().then((folders) => {
          console.log(folders.length + ' media folders');
          subsonic.getIndexes(folders[0].id).then((artists) => {
            console.log('got artist starting with: ' + artists[0].name);
            subsonic.getMusicDirectory(artists[0].artist[0].id).then((albums) => {
              console.log('got tracks on the album: ' + albums.child[0].title + ' by '  + albums.child[0].artist);
              subsonic.getMusicDirectory(albums.child[0].id).then((tracks) => {
                console.log('playing first track on ' + tracks.name);
                let audio = new Audio();
                audio.src = subsonic.streamUrl(tracks.child[0].id, 320);
                audio.controls = true;
                document.querySelector('body').appendChild(audio);
                audio.play();
                subsonic.getArtist().then((artists) => {
                  subsonic.getArtist(artists[0].artist[0].id).then((artist) => {
                    subsonic.getTopSongs(10, artist.name).then((top10) => {
                      console.log('getting top 10 songs for artist ' + artist.name);
                      top10.forEach((song) => {
                        console.log(song.title + ',');
                      });
                      subsonic.getGenres().then((genres) => {
                        console.log('# of genres: ' + genres.length);
                        subsonic.getAlbumList2('frequent').then((albums) => {
                          console.log(albums.length + ' frequently played albums');
                          subsonic.getAlbum(albums[0].id).then((album) => {
                            console.log(album)
                          });
                        });
                      });
                    });
                  });
                });
              });
            });
          });
        });

      } else {
        // failed login details in event.detail.error
      }
    });
  })();
</script>
